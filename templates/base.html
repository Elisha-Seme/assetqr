<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}AssetQR{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- Mobile top bar (hidden on desktop) -->
<header class="mobile-header">
  <button class="mobile-hamburger" id="mobile-hamburger" aria-label="Open menu">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
  </button>
  <img src="{{ url_for('static', filename='afosi_logo.png') }}" alt="AFOSI" class="mobile-brand-logo">
  <span class="mobile-brand-name">Asset Registry</span>
</header>

<!-- Sidebar backdrop (mobile) -->
<div id="sidebar-overlay" class="sidebar-overlay"></div>

<nav class="sidebar" id="sidebar">
  <div class="sidebar-brand">
    <img src="{{ url_for('static', filename='afosi_logo.png') }}" alt="AFOSI" class="brand-logo">
    <div>
      <div class="brand-name">AFOSI</div>
      <div class="brand-sub">Asset Registry</div>
    </div>
  </div>

  <ul class="nav-list">
    <li>
      <a href="{{ url_for('dashboard') }}" class="nav-link{% if request.endpoint == 'dashboard' %} active{% endif %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/>
          <rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/>
        </svg>
        Dashboard
      </a>
    </li>
    <li>
      <a href="{{ url_for('assets_page') }}" class="nav-link{% if request.endpoint == 'assets_page' %} active{% endif %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 7H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z"/>
          <path d="M16 7V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v2"/>
          <line x1="12" y1="12" x2="12" y2="16"/><line x1="10" y1="14" x2="14" y2="14"/>
        </svg>
        Assets
      </a>
    </li>
    <li>
      <a href="{{ url_for('import_page') }}" class="nav-link{% if request.endpoint == 'import_page' %} active{% endif %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
          <polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
        Import
      </a>
    </li>
    <li>
      <a href="{{ url_for('settings_page') }}" class="nav-link{% if request.endpoint == 'settings_page' %} active{% endif %}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
        </svg>
        Settings
      </a>
    </li>
  </ul>

  <div class="sidebar-footer">
    <div style="font-size:11px;color:rgba(255,255,255,.35);margin-bottom:8px">
      Signed in as <strong style="color:rgba(255,255,255,.55)">{{ session.get('username','admin') }}</strong>
    </div>
    <a href="{{ url_for('logout') }}" class="nav-link" style="padding:7px 10px;font-size:12px;color:#f87171">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px;opacity:1">
        <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
        <polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
      Sign Out
    </a>
    <div style="font-size:10px;color:rgba(255,255,255,.15);margin-top:8px">AssetQR v1.0</div>
  </div>
</nav>

<main class="main-content">
  {% block content %}{% endblock %}
</main>

<!-- Toast container -->
<div id="toast-container"></div>

<!-- Overlay -->
<div id="modal-overlay" onclick="closeAllModals()"></div>

<!-- Asset Add/Edit Modal -->
<div id="asset-modal" class="modal" role="dialog" aria-modal="true">
  <div class="modal-header">
    <h3 id="asset-modal-title">Add Asset</h3>
    <button class="modal-close" onclick="closeAllModals()">&times;</button>
  </div>
  <div class="modal-body">
    <input type="hidden" id="edit-asset-db-id">
    <div class="form-grid">
      <div class="form-group">
        <label for="f-name">Name <span class="req">*</span></label>
        <input type="text" id="f-name" placeholder="e.g. Dell Laptop XPS 13" autocomplete="off">
      </div>
      <div class="form-group">
        <label for="f-asset-id">Asset ID <span class="hint">(auto-generated if blank)</span></label>
        <input type="text" id="f-asset-id" placeholder="e.g. LAP-001" autocomplete="off">
      </div>
      <div class="form-group">
        <label for="f-category">Category</label>
        <input type="text" id="f-category" placeholder="e.g. IT Equipment" list="cat-list" autocomplete="off">
        <datalist id="cat-list"></datalist>
      </div>
      <div class="form-group">
        <label for="f-location">Location</label>
        <input type="text" id="f-location" placeholder="e.g. Room 201, Building A" autocomplete="off">
      </div>
      <div class="form-group">
        <label for="f-status">Status</label>
        <select id="f-status">
          <option value="active">Active</option>
          <option value="maintenance">Maintenance</option>
          <option value="retired">Retired</option>
        </select>
      </div>
      <div class="form-group">
        <label for="f-serial">Serial Number</label>
        <input type="text" id="f-serial" placeholder="e.g. SN-XPS-001" autocomplete="off">
      </div>
      <div class="form-group">
        <label for="f-purchase-date">Purchase Date</label>
        <input type="date" id="f-purchase-date">
      </div>
      <div class="form-group form-group--full">
        <label for="f-description">Description</label>
        <textarea id="f-description" rows="2" placeholder="Brief description of the asset"></textarea>
      </div>
      <div class="form-group form-group--full">
        <label for="f-notes">Notes</label>
        <textarea id="f-notes" rows="2" placeholder="Internal notes"></textarea>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-ghost" onclick="closeAllModals()">Cancel</button>
    <button class="btn btn-primary" onclick="saveAsset()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
      Save Asset
    </button>
  </div>
</div>

<!-- QR Preview Modal -->
<div id="qr-modal" class="modal modal--sm" role="dialog" aria-modal="true">
  <div class="modal-header">
    <h3 id="qr-modal-title">QR Code</h3>
    <button class="modal-close" onclick="closeAllModals()">&times;</button>
  </div>
  <div class="modal-body" style="text-align:center">
    <img id="qr-preview-img" src="" alt="QR Code" style="max-width:220px;border:1px solid #e2e8f0;border-radius:8px;padding:8px">
    <p id="qr-preview-url" style="font-size:11px;color:#64748b;word-break:break-all;margin-top:8px"></p>
  </div>
  <div class="modal-footer" style="justify-content:center;gap:8px">
    <a id="qr-download-btn" class="btn btn-primary" download>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
      Download PNG
    </a>
    <button id="qr-label-btn" class="btn btn-ghost" onclick="exportSingleLabel()">
      Print Label
    </button>
  </div>
</div>

<!-- Delete Confirm Modal -->
<div id="delete-modal" class="modal modal--sm" role="dialog" aria-modal="true">
  <div class="modal-header">
    <h3>Delete Asset</h3>
    <button class="modal-close" onclick="closeAllModals()">&times;</button>
  </div>
  <div class="modal-body">
    <p>Are you sure you want to delete <strong id="delete-asset-name"></strong>? This cannot be undone.</p>
  </div>
  <div class="modal-footer">
    <button class="btn btn-ghost" onclick="closeAllModals()">Cancel</button>
    <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
  </div>
</div>

<script src="{{ url_for('static', filename='js/app.js') }}"></script>
{% block scripts %}{% endblock %}

<script>
/* ── Mobile sidebar toggle ──────────────────────────────────────────────── */
(function () {
  var hamburger = document.getElementById('mobile-hamburger');
  var sidebar   = document.getElementById('sidebar');
  var overlay   = document.getElementById('sidebar-overlay');

  function openSidebar() {
    sidebar.classList.add('open');
    overlay.classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  function closeSidebar() {
    sidebar.classList.remove('open');
    overlay.classList.remove('open');
    document.body.style.overflow = '';
  }

  if (hamburger) {
    hamburger.addEventListener('click', function () {
      sidebar.classList.contains('open') ? closeSidebar() : openSidebar();
    });
  }
  if (overlay) {
    overlay.addEventListener('click', closeSidebar);
  }
  sidebar.querySelectorAll('.nav-link').forEach(function (link) {
    link.addEventListener('click', function () {
      if (window.innerWidth <= 768) closeSidebar();
    });
  });
})();
</script>
</body>
</html>
